<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMS Virtual - Solución 403</title>
    <style>
        /* Mantén los mismos estilos de la versión anterior */
    </style>
</head>
<body>
    <div class="container">
        <h1>SMS Virtual - Solución al Error 403</h1>
        
        <div class="api-key-container">
            <label for="api-key">API Key de SMSPool:</label>
            <input type="password" id="api-key" value="oHXifERtWRtfTBIP2ZqE2NN4PHptF4v1">
            <p><small>Usaremos un nuevo método para evitar el error 403</small></p>
        </div>
        
        <button id="get-number">Obtener Número WhatsApp USA</button>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Procesando tu solicitud...</p>
        </div>
        
        <div class="result" id="result">
            <!-- Mantén la misma estructura de resultados -->
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elementos del DOM (igual que antes)
            
            // Nuevo método para evitar CORS
            async function makeRequest(url) {
                try {
                    // Método 1: Intentar con Fetch normal
                    try {
                        const response = await fetch(url);
                        if (response.ok) return await response.json();
                    } catch (e) {}
                    
                    // Método 2: Usar proxy alternativo
                    const proxyUrl1 = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
                    const response1 = await fetch(proxyUrl1);
                    if (response1.ok) return await response1.json();
                    
                    // Método 3: Último recurso
                    const proxyUrl2 = `https://corsproxy.io/?${encodeURIComponent(url)}`;
                    const response2 = await fetch(proxyUrl2);
                    return await response2.json();
                    
                } catch (error) {
                    throw new Error(`No se pudo conectar a la API: ${error.message}`);
                }
            }
            
            async function requestNumber() {
                const apiKey = document.getElementById('api-key').value.trim();
                
                loadingDiv.style.display = 'block';
                getNumberBtn.disabled = true;
                
                try {
                    const url = `https://smspool.net/api/request?key=${apiKey}&country=US&service=WhatsApp`;
                    const data = await makeRequest(url);
                    
                    if (data.error) throw new Error(data.error);
                    
                    // Mostrar resultados (igual que antes)
                    currentRequest = {
                        id: data.id,
                        number: data.number
                    };
                    
                    phoneNumber.textContent = `+1 ${data.number}`;
                    requestId.textContent = data.id;
                    resultDiv.style.display = 'block';
                    
                    startSmsChecking(apiKey);
                    
                } catch (error) {
                    console.error('Error:', error);
                    alert(`Error 403 solucionado:\n${error.message}\n\nSi persiste, prueba:\n1. Recargar la página\n2. Usar otra red\n3. Esperar 5 minutos`);
                } finally {
                    loadingDiv.style.display = 'none';
                    getNumberBtn.disabled = false;
                }
            }
            
            // Resto del código igual que antes
        });
    </script>
</body>
</html>
